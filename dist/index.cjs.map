{"version":3,"file":"index.cjs","sources":["../src/constants.ts","../src/utils.ts","../src/logger.ts"],"sourcesContent":["import type { IStorageLoggerOptions, LogLevel } from './types';\n\nexport const ENV_LOG_LEVEL = typeof process !== 'undefined' ? process.env['REACT_APP_LOG_LEVEL'] : 'error';\n\nexport const LOG_LEVELS = <const>['log', 'fatal', 'error', 'warn', 'info', 'debug'];\n\nexport const STYLES = {\n  inherit: 'color: inherit',\n  dim: 'color: #666',\n  log: 'color: lightslategray',\n  fatal: 'color: gold; background-color: firebrick',\n  error: 'color: firebrick',\n  warn: 'color: gold',\n  info: 'color: deepskyblue',\n  debug: 'color: magenta'\n};\n\nexport const DEFAULTS = {\n  type: 'local' as 'local',\n  maxLines: 10,\n  key: '$uid' as IStorageLoggerOptions['key'],\n  keyValue: () => Date.now(),\n  userKey: 'user',\n  level: ENV_LOG_LEVEL as LogLevel,\n  consoleOutput: 'development' as IStorageLoggerOptions['consoleOutput'],\n  styles: { ...STYLES }\n};\n\n","import type { Style, Styles } from './types';\n\n/**\n * Creates instance of simple formatter.\n */\nexport function formatter(styles: Styles) {\n\n  const _tokens = [] as string[];\n  const _styles = [] as string[];\n\n  const api = {\n    tokens: _tokens,\n    styles: _styles,\n    add,\n    unstyled,\n    toString\n  };\n\n  /**\n   * Adds a styled value to tokens to be formatted.\n   * \n   * @param style the style to be applied.\n   * @param label the value to apply style to.\n   */\n  function add(style: Style, label: any) {\n    _tokens.push(`%c` + label)\n    _styles.push(styles[style]);\n    return api;\n  }\n\n  /**\n   * Add unstyled value.\n   * \n   * @param label the value to be unstyled.\n   */\n  function unstyled(label: any) {\n    return add('inherit', label);\n  }\n\n  /**\n   * Converts tokens and values to styled result for logging.\n   */\n  function toString() {\n    return [_tokens.join(' '), ..._styles];\n  }\n\n  return api;\n\n}\n\n/**\n * Gets a timestamp.\n * \n * @param date optional date.\n */\nexport function getTimestamp(date = Date.now()) {\n  return (new Date(date)).toISOString();\n}\n\n/**\n * Normalizes a namespace.\n * \n * @param ns the namespace to format.\n * @param parent the parent to be prefixed.\n */\nexport function formatNamespace(ns: string, parent: string) {\n  const segments = [...parent.split('.'), ns];\n  return segments.join('.');\n}\n\n/**\n * Converts an error to object literal.\n * \n * @param err the error to convert to object\n */\nexport function serializeError<E extends Error>(err: E & { [key: string]: any }) {\n  if (!(err instanceof Error))\n    return err;\n  const result = Object.getOwnPropertyNames(err).reduce((a, c) => {\n    a[c as keyof E] = err[c];\n    return a;\n  }, {} as Record<keyof E, any>);\n  if (err.name && !result.name)\n    result.name = err.name;\n  return result;\n}\n","import { formatNamespace, formatter, getTimestamp, serializeError } from './utils';\nimport { DEFAULTS, LOG_LEVELS } from './constants';\nimport type { IStorageLoggerOptions, LogLevel, \n  StorageLoggerEvent, StorageLoggerPayload, Style } from './types';\n\n/**\n * Creates a new storage logger instance.\n * \n * @param options storage logger options. \n * @param namespaces currently loaded namespaces.\n */\nfunction createStorageLogger<K extends string = '$uid', U extends Record<string, any> = Record<string, any>>(options: IStorageLoggerOptions<K>, namespaces: string[] = []) {\n\n  type Logger = typeof logger;\n\n  options = {\n    ...DEFAULTS as any,\n    ...options\n  };\n\n  const store = options.type === 'local' ? localStorage : sessionStorage;\n\n  const { parent, namespace, maxLines, key, keyValue, userKey, level: initLevel, consoleOutput, styles } = options as Required<IStorageLoggerOptions<K>>;\n\n  const activeNamespace = formatNamespace(namespace, parent);\n\n  let _queue: StorageLoggerEvent<K, U>[] = [];\n  let _queueId: any;\n\n  if (!namespaces.includes(activeNamespace))\n    namespaces.push(activeNamespace);\n\n  /**\n   * Clears the log queue.\n   */\n  function clearQueue() {\n    if (!_queueId) return;\n    clearInterval(_queueId);\n    _queue = [];\n  }\n\n  /**\n   * Starts the log queue.\n   */\n  function startQueue() {\n    _queueId = setInterval(() => {\n      if (!_queue.length)\n        return clearQueue();\n      writePayload(activeNamespace, _queue.shift() as StorageLoggerEvent<K, U>);\n    }, 150);\n  }\n\n  /**\n   * Gets namespaced value by key.\n   * \n   * @param ns the namespace to get.\n   */\n  function getKey(ns: string): StorageLoggerEvent<K, U>[] {\n    const obj = store.getItem(ns);\n    return obj && obj.length ? JSON.parse(obj) : [];\n  }\n\n  /**\n   * Gets a user from storage.\n   * NOTE: always uses localStorage.\n   * \n   * @param key the user key for retrieving user object.\n   */\n  function getUser(key: string) {\n    const user = localStorage.getItem(key);\n    const item = store.getItem(key);\n    if (!user || !item)\n      return null;\n    return JSON.parse(item);\n  }\n\n  /**\n   * Sets a namespace's value.\n   * \n   * @param ns the names apce to be set.\n   * @param data the value to set to the namespace.\n   */\n  function setKey(ns: string, data: StorageLoggerEvent<K, U> | StorageLoggerEvent<K, U>[]) {\n    if (!data) return;\n    if (!Array.isArray(data))\n      data = [data];\n    const str = JSON.stringify(data);\n    store.setItem(ns, str);\n  }\n\n  function removeKey(ns: string) {\n    store.removeItem(ns);\n  }\n\n  /**\n   * Deletes rows for the given namespace.\n   * \n   * @param ns the namespace to delete rows for.\n   * @param count the number of rows to delete if not 1.\n   */\n  function deleteRows(ns: string, count = 1) {\n    const rows = getKey(ns);\n    rows.sort((a, b) => {\n      if (a.timestamp > b.timestamp)\n        return 1;\n      else if (a.timestamp < b.timestamp)\n        return -1;\n      else\n        return 0;\n    }).splice(0, count);\n    setKey(ns, rows);\n  }\n\n  /**\n   * Gets the number of rows for a namespace.\n   * \n   * @param ns the namespace to get row count for.\n   */\n  function rowsCount(ns: string) {\n    return getKey(ns).length;\n  }\n\n  /**\n   * Gets the size of a namespace.\n   * \n   * @param ns the namespace to get size for.\n   */\n  function checkSize(ns: string) {\n    if (!maxLines) return;\n    const count = rowsCount(ns);\n    if (count === maxLines) {\n      deleteRows(ns);\n    }\n    else if (count > maxLines) {\n      const adj = count - maxLines;\n      deleteRows(ns, adj);\n    }\n  }\n\n  /**\n   * Checks if a level is active.\n   * \n   * @param level the level to inspect as active.\n   */\n  function isActiveLevel(level: LogLevel) {\n    const curIndex = LOG_LEVELS.indexOf(level);\n    const loggerIndex = LOG_LEVELS.indexOf(logger.level as LogLevel);\n    return curIndex <= loggerIndex;\n  }\n\n  /**\n   * Checks if should output to console as well as log to storage.\n   */\n  function shouldOutput() {\n    return (consoleOutput === 'always' || process.env['NODE_ENV'] !== 'production');\n  }\n\n  /**\n   * Writes the payload to storage by namespace.\n   * \n   * @param ns the namespace to be written.\n   * @param payload the payload to be written.\n   */\n  function writePayload(ns: string, payload: StorageLoggerEvent<K, U>) {\n    const rows = [...getKey(ns), payload];\n    if (shouldOutput()) {\n      const tsKey = getTimestamp(payload[key]).split('.').shift()?.split('T').join(' ');\n      const trimNs = ns.replace(/^logger\\./, '');\n      const truncMessage = payload.message.slice(0, 25);\n      const groupLabel = formatter(styles)\n        .add(payload.level as Style, tsKey)\n        .unstyled(trimNs)\n        .unstyled('-')\n        .add('dim', truncMessage)\n        .toString();\n      console.groupCollapsed(...groupLabel);\n      console.log(payload);\n      console.groupEnd();\n    }\n    setKey(ns, rows);\n  }\n\n  /**\n    * Logs a payload by log level.\n    * \n    * @param level the level being logged.\n    * @param payload the value or payload to log.\n    */\n  function logger(level: LogLevel, payload: StorageLoggerPayload): Logger;\n\n  /**\n   * Logs a payload by default level.\n   * \n   * @param payload the value or payload to log.\n   */\n  function logger(payload: StorageLoggerPayload): Logger;\n\n  function logger(level: LogLevel | StorageLoggerPayload, payload?: StorageLoggerPayload) {\n\n    // We don't want to log empty lines in local storage.\n    if (typeof level === 'undefined')\n      return logger;\n\n    if (!payload) {\n      payload = level;\n      level = '';\n    }\n\n    level = level || 'log';\n\n    if (!isActiveLevel(logger.level as LogLevel))\n      return logger;\n\n    if (typeof payload === 'string')\n      payload = { message: payload };\n\n    else if (payload instanceof Error)\n      payload = serializeError(payload);\n\n    checkSize(activeNamespace);\n\n    const _payload = payload as StorageLoggerEvent<K, U>;\n    _payload[key as K] = keyValue() as any;\n    _payload.namespace = activeNamespace;\n    _payload.timestamp = getTimestamp();\n    _payload.message = _payload.message || '';\n\n    if (userKey)\n      _payload.user = getUser(userKey);\n\n    // Add to the queue.\n    _queue.push(_payload);\n\n    if (!_queueId)\n      startQueue();\n\n    return logger;\n\n  }\n\n  /**\n   * The current enabled log level.\n   */\n  logger.level = initLevel as Omit<LogLevel, 'log'>;\n\n  /**\n   * The active namespace.\n   */\n  logger.namespace = activeNamespace;\n\n  /**\n   * An array of logger namespaces.\n   */\n  logger.namespaces = namespaces;\n\n  /**\n   * Logs a payload by default level.\n   * \n   * @param payload the payload to be logged.\n   */\n  logger.log = (payload: StorageLoggerPayload) => logger('log', payload);\n\n  /**\n   * Logs a payload by fatal log level.\n   * \n   * @param payload the payload to be logged.\n   */\n  logger.fatal = (payload: StorageLoggerPayload) => logger('fatal', payload);\n\n  /**\n   * Logs a payload by error log level.\n   * \n   * @param payload the payload to be logged.\n   */\n  logger.error = (payload: StorageLoggerPayload) => logger('error', payload);\n\n  /**\n   * Logs a payload by warn log level.\n   * \n   * @param payload the payload to be logged.\n   */\n  logger.warn = (payload: StorageLoggerPayload) => logger('warn', payload);\n\n  /**\n   * Logs a payload by info log level.\n   * \n   * @param payload the payload to be logged.\n   */\n  logger.info = (payload: StorageLoggerPayload) => logger('info', payload);\n\n  /**\n   * Logs a payload by debug log level.\n   * \n   * @param payload the payload to be logged.\n   */\n  logger.debug = (payload: StorageLoggerPayload) => logger('debug', payload);\n\n  /**\n   * Creates a child logger instance.\n   * \n   * @example\n   * import defLogger from './path/to/logger'\n   * const logger = defLogger.child('your.namespace');\n   * \n   * @param ns the namspace of the child to create.\n   */\n  logger.child = (ns: string) => {\n    const nextParent = /global$/.test(activeNamespace) ? 'logger' : activeNamespace;\n    return createStorageLogger<K>({ ...options, parent: nextParent, namespace: ns }, namespaces);\n  };\n\n  /**\n   * Returns rows for the active namespace.\n   * \n   * @param limit value used to limit returned rows.\n   */\n  logger.rows = (limit = 0) => {\n    let rows = getKey(activeNamespace).reverse();\n    if (limit)\n      rows = rows.slice(0, limit);\n    return rows;\n  };\n\n  /**\n   * Gets the size of the namespace by row count.\n   */\n  logger.size = () => rowsCount(activeNamespace);\n\n  /**\n   * Clears the current namespace.\n   */\n  logger.clear = () => {\n    removeKey(activeNamespace);\n  };\n\n  /**\n   * Clears all namespaces.\n   */\n  logger.clearAll = () => namespaces.forEach(ns => removeKey(ns));\n\n  /**\n   * Purges lines from the logger.\n   * \n   * @param lines the number of lines to purge.\n   */\n  logger.purge = (lines = 1) => {\n    deleteRows(activeNamespace, lines);\n  };\n\n  return logger;\n\n}\n\n/**\n * Default logger instance.\n */\nconst defaultLogger = createStorageLogger({ parent: 'logger', namespace: 'global' });\n\nexport default defaultLogger;"],"names":[],"mappings":"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"}